class u{constructor(t){this._sceneList=[],this._gl=t}solveModel(t){t._gl_Solver(this._gl)}add(t){this.solveModel(t),this._sceneList.push(t)}}class f{constructor(t,i){this.getCanvas(t,i),this._initRender()}getCanvas(t,i){this.canvas=document.querySelector(`#${t}`),this.gl=this.canvas.getContext("webgl",i),this.gl||console.error("您的设备不支持webgl")}_initRender(){this.scene=new u(this.gl),console.log(`

████████╗██╗    ██╗██╗███╗   ██╗███████╗██████╗  █████╗  ██████╗███████╗██████╗ ██████╗ 
╚══██╔══╝██║    ██║██║████╗  ██║██╔════╝██╔══██╗██╔══██╗██╔════╝██╔════╝╚════██╗██╔══██╗
   ██║   ██║ █╗ ██║██║██╔██╗ ██║███████╗██████╔╝███████║██║     █████╗   █████╔╝██║  ██║
   ██║   ██║███╗██║██║██║╚██╗██║╚════██║██╔═══╝ ██╔══██║██║     ██╔══╝  ██╔═══╝ ██║  ██║
   ██║   ╚███╔███╔╝██║██║ ╚████║███████║██║     ██║  ██║╚██████╗███████╗███████╗██████╔╝
   ╚═╝    ╚══╝╚══╝ ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝     ╚═╝  ╚═╝ ╚═════╝╚══════╝╚══════╝╚═════╝ 
                                                                                        

`)}render(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT);for(let t=0,i=this.scene._sceneList.length;t<i;t++)this.scene._sceneList[t].updateMesh(this.gl)}}class p{constructor(){this._init_GeometryAttribute(),this._gl_init()}_init_GeometryAttribute(){this.attributes={}}setAttribute(t,i,e){this.attributes[t]={array:i,count:e},this.countNum=i.length}_gl_init(){this._gl_attribute={}}_gl_attribute_solver(t,i){for(let e in this.attributes)this._gl_attribute[e]=i.getAttribLocation(t,e)}_gl_update_attributes(t){for(let i in this._gl_attribute){const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,this.attributes[i].array,t.STATIC_DRAW),t.enableVertexAttribArray(this._gl_attribute[i]),t.bindBuffer(t.ARRAY_BUFFER,e);const _=this.attributes[i].count,s=t.FLOAT,l=!1,g=0,h=0;t.vertexAttribPointer(this._gl_attribute[i],_,s,l,g,h)}}setPosition(t){const i=[];for(let _=0,s=t.length;_<s;_++)i[2*_]=t[_].x,i[2*_+1]=t[_].y;const e=this.setIndex([0,1,2,2,3,0],i);this.setAttribute("a_position",new Float32Array(e),2)}setIndex(t,i){const e=[];for(let _=0,s=t.length;_<s;_++)e.push(i[2*t[_]]),e.push(i[2*t[_]+1]);return e}}const m=(r,t)=>new Proxy(r,{set:function(i,e,_,s){const l=i[e],g=Reflect.set(i,e,_,s);return l!==_&&typeof t=="function"&&t({property:e,oldValue:l,newValue:_}),g}});function n(r,t,i){var e=r.createShader(t);if(r.shaderSource(e,i),r.compileShader(e),r.getShaderParameter(e,r.COMPILE_STATUS))return e;console.log(r.getShaderInfoLog(e)),r.deleteShader(e)}class d{constructor({uniforms:t,fragmentShader:i,vertexShader:e}){this._gl_introduceUniform(t),this.fragmentShader=i,this.vertexShader=e,this._gl_init()}_gl_introduceUniform(t){this.uniforms={};for(let i in t)this.uniforms[i]=m(t[i],({newValue:e})=>{this._gl_uniforms_ChangeUpdate(i,e)})}_gl_uniforms_ChangeUpdate(t,i){i&&this._gl_uniform_update(t,this._gl_program)}_gl_init(){this._gl_uniform_number={},this._gl_uniform_obj={},this._gl=null}_gl_program_creator(){const t=n(this._gl,this._gl.VERTEX_SHADER,this.vertexShader),i=n(this._gl,this._gl.FRAGMENT_SHADER,this.fragmentShader);return this._gl_program=function(e,_,s){var l=e.createProgram();if(e.attachShader(l,_),e.attachShader(l,s),e.linkProgram(l),e.getProgramParameter(l,e.LINK_STATUS))return l;e.deleteProgram(l)}(this._gl,t,i),this._gl_program}_gl_uniforms_solver(t){for(let i in this.uniforms)this.uniforms[i].value&&this._gl_uniform_update(i,t)}_gl_uniform_update(t,i){typeof this.uniforms[t].value=="number"?this._gl_uniform_number[t]=this._gl.getUniformLocation(i,t):(this.uniforms[t].value._init_gl(this._gl,i),this.uniforms[t].value._gl_creator(t),this._gl_uniform_obj[t]=this.uniforms[t].value)}_gl_update_uniforms(t){for(let i in this._gl_uniform_obj)this._gl_uniform_obj[i]._gl_update();for(let i in this._gl_uniform_number)t.uniform1f(this._gl_uniform_number[i],this.uniforms[i].value)}}class E{constructor(t,i){this.isVec2=!0,this.type="Vec2",this.x=t,this.y=i}_init_gl(t,i){this._gl=t,this._gl_program=i,this._gl_target=null}_gl_creator(t){this._gl_target=this._gl.getUniformLocation(this._gl_program,t)}_gl_update(){this._gl_target&&this._gl.uniform2f(this._gl_target,this.x,this.y)}}class R{constructor(t,i){this.geometry=t,this.material=i,this._gl_init()}_gl_init(){this._gl_attribute={},this._gl_program}_gl_Solver(t){this.material._gl=t,this._gl_program=this.material._gl_program_creator(),this.geometry._gl_attribute_solver(this._gl_program,t),this.material._gl_uniforms_solver(this._gl_program)}updateMesh(t){(function(_,s){s=s||1;const l=_.clientWidth*s|0,g=_.clientHeight*s|0;(_.width!==l||_.height!==g)&&(_.width=l,_.height=g)})(t.canvas),t.viewport(0,0,t.canvas.width,t.canvas.height),t.useProgram(this._gl_program),this.geometry._gl_update_attributes(t),this.material._gl_update_uniforms(t);var i=t.TRIANGLES,e=this.geometry.countNum/2;t.drawArrays(i,0,e)}}function a(r){return(r&r-1)==0}class c{constructor(){this.isTexture=!0,this.type="texture",this._init()}_init(){this._image=null,this._flipY=!1}set image(t){a(t.width)&&a(t.height)?(this._image=t,this._image&&this._gl_creator()):((i,e)=>{const _=Math.pow(2,Math.ceil(Math.log2(i.width))),s=Math.pow(2,Math.ceil(Math.log2(i.height))),l=document.createElement("canvas"),g=l.getContext("2d");l.width=_,l.height=s,g.clearRect(0,0,_,s),g.drawImage(i,0,0,_,s);const h=l.toDataURL(),o=new Image;o.src=h,o.onload=()=>{typeof e=="function"&&e(o)}})(t,i=>{this._image=i,this._image&&this._gl_creator()})}get image(){return this._image}set flipY(t){typeof t=="boolean"&&(this._flipY=t,this._gl_updateUniformsAttribute())}get flipY(){return this._flipY}_init_gl(t,i){this._gl=t,this._gl_program=i,this._gl_target=null,this._gl_image_repeat="CLAMP_TO_EDGE",this._gl_uniform_texture_location=null}set repeat(t){t=="normal"?this._gl_image_repeat="CLAMP_TO_EDGE":t=="repeat"?this._gl_image_repeat="REPEAT":t=="mirror"&&(this._gl_image_repeat="MIRRORED_REPEAT"),this._gl_updateUniformsAttribute()}get repeat(){return this._gl_image_repeat=="CLAMP_TO_EDGE"?"normal":this._gl_image_repeat=="REPEAT"?"repeat":this._gl_image_repeat=="MIRRORED_REPEAT"?"mirror":void 0}_gl_updateUniformsAttribute(){this._gl_creator()}_gl_creator(t){if(this._image){this._gl_uniform_texture_location=this._gl.getUniformLocation(this._gl_program,t),this._gl_target=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._gl_target);const i=0,e=this._gl.RGBA,_=this._gl.RGBA,s=this._gl.UNSIGNED_BYTE;this._gl.texImage2D(this._gl.TEXTURE_2D,i,e,_,s,this._image),a(this._image.width)&&a(this._image.height)&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl[this._gl_image_repeat]),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl[this._gl_image_repeat]),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._flipY&&this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,!0)}}_gl_update(){this._gl_target&&this._gl_uniform_texture_location&&(this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._gl_target),this._gl.uniform1i(this._gl_uniform_texture_location,0))}}class T{constructor(){}load(t,i){const e=new c,_=new Image;return _.src=t,_.onload=()=>(e.image=_,typeof i=="function"&&i(e),e),e}}export{T as c,p as e,f as i,E as l,R as o,d as s};
